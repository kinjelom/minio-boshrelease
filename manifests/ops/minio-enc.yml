---

# When set, the nodes in the minio cluster will communicate with each other using '$NODE_ID.$DNS_ALIAS' as the hostname.
# HTTPS certs should use this domain as the Common Name plus a wildcard Subject Alt Name, e.g. 'minio-server.service.cf.internal' and '*.minio-server.service.cf.internal'.
# This is a temporary workaround until BOSH DNS supports autogenerated certs for BOSH DNS records.
# example: "minio-server.service.cf.internal"

- type: replace
  path: /instance_groups/name=minio/jobs/name=minio-server/properties?/dns?/alias?
  value: ((minio_bosh_dns_alias))

- type: replace
  path: /variables?/-
  value:
    name: services_ca
    type: certificate
    options:
      common_name: services
      is_ca: true

- type: replace
  path: /variables?/-
  value:
    name: minio_server_tls
    type: certificate
    update_mode: converge
    options:
      ca: services_ca
      common_name: ((minio_bosh_dns_alias))
      alternative_names:
        - ((minio_bosh_dns_alias))
        - "*.((minio_bosh_dns_alias))"
        - ((minio_api_uri))
        - ((minio_console_uri))
      duration: 3650

- type: replace
  path: /instance_groups/name=minio/jobs/name=minio-server/properties?/tls?/enable?
  value: true

- type: replace
  path: /instance_groups/name=minio/jobs/name=minio-server/properties?/tls?/certs?/ca?
  value: ((minio_server_tls.ca))

- type: replace
  path: /instance_groups/name=minio/jobs/name=minio-server/properties?/tls?/certs?/certificate?
  value: ((minio_server_tls.certificate))

- type: replace
  path: /instance_groups/name=minio/jobs/name=minio-server/properties?/tls?/certs?/private_key?
  value: ((minio_server_tls.private_key))
