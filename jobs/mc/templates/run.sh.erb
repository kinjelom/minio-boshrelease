#!/bin/bash

MC_HOME="/var/vcap/packages/mc"
CONFIG_DIR="/var/vcap/jobs/mc/config"
ACCESS_KEY="<%= link('minio').p('credential.root_user') %>"
SECRET_KEY="<%= link('minio').p('credential.root_password') %>"
<%
  port = link('minio').p('port')
  instance0 = link('minio').instances[0]
  server_url = "http://${ACCESS_KEY}:${SECRET_KEY}@#{instance0.address}:#{port}"
  if p('tls.enable', false)
    if_p('dns.alias') do |dns_alias|
      server_url = "https://${ACCESS_KEY}:${SECRET_KEY}@#{instance0.id}.#{dns_alias}:#{port}"
    end.else do
      server_url = "https://${ACCESS_KEY}:${SECRET_KEY}@#{instance0.address}:#{port}"
    end
  end
%>
MC_HOST_THIS_MINIO="<%= server_url %>"
bash << EOF
<%= p("script") %>
EOF
