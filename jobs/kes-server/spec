---
name: kes-server
templates:
  bin/ctl.sh.erb: bin/ctl
  bin/health_check.sh.erb: bin/health_check.sh
  bin/pre-start.sh.erb: bin/pre-start
  config/server-config.yaml.erb: config/server-config.yaml
  config/certs/kes-clients/cas/clients-ca.crt.erb: config/certs/kes-clients/cas/clients-ca.crt
  config/certs/kes-clients/client-admin.crt.erb: config/certs/kes-clients/client-admin.crt
  config/certs/kes-clients/client-admin.key.erb: config/certs/kes-clients/client-admin.key
  config/certs/kes-server/kes-server-ca.crt.erb: config/certs/kes-server/kes-server-ca.crt
  config/certs/kes-server/kes-server.crt.erb: config/certs/kes-server/kes-server.crt
  config/certs/kes-server/kes-server.key.erb: config/certs/kes-server/kes-server.key
  config/certs/credhub/credhub-client.crt.erb: config/certs/credhub/credhub-client.crt
  config/certs/credhub/credhub-client.key.erb: config/certs/credhub/credhub-client.key
  config/certs/credhub/credhub-server-ca.crt.erb: config/certs/credhub/credhub-server-ca.crt

packages:
  - kes

provides:
  - name: kes-server
    type: kes-tls-config
    properties:
      - port
      - tls.certs.kes_client_admin
      - tls.certs.kes_server.ca

properties:
  address:
    description: "The address on which the KES server should bind"
    default: "0.0.0.0"
  port:
    description: "The port on which the KES server should bind"
    default: 7373
  tls.certs.kes_clients_ca.certificate:
    description: "CA certificate for verifying the mTLS certificates sent by the KES clients"
    default: ~
  tls.certs.kes_client_admin.certificate:
    description: "The certificate for KES admin client TLS"
    default: ~
  tls.certs.kes_client_admin.private_key:
    description: "The private key for KES admin client TLS"
    default: ~
  tls.certs.kes_server.ca:
    description: "The CA certificate for KES server TLS"
    default: ~
  tls.certs.kes_server.certificate:
    description: "The certificate for KES server TLS"
    default: ~
  tls.certs.kes_server.private_key:
    description: "The private key for KES server TLS"
    default: ~

  keystore.credhub.base_url:
    description: "The base URL endpoint of the CredHub service."
    default: "http://localhost:8844"
  keystore.credhub.enable_mutual_tls:
    description: "If set to true, enables mutual TLS."
    default: "true"
  keystore.credhub.certs.client.certificate:
    description: "The client's certificate used for mutual TLS authentication."
    default: ~
  keystore.credhub.certs.client.private_key:
    description: "The client's private key used for mutual TLS authentication."
    default: ~
  keystore.credhub.server_insecure_skip_verify:
    description: "If set to true, server's certificate will not be verified against the provided CA certificate."
    default: "false"
  keystore.credhub.certs.server_ca.certificate:
    description: "The CA certificate for verifying the CredHub server's certificate."
    default: ~
  keystore.credhub.namespace:
    description: "A namespace within CredHub where credentials are stored."
    default: "/kes"
  keystore.credhub.force_base64_values_encoding:
    description: "If set to true, forces encoding of all the values as base64 before storage."
    default: "false"
